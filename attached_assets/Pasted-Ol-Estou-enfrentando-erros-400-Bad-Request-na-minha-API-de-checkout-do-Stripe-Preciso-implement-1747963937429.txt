Ol√°! Estou enfrentando erros 400 (Bad Request) na minha API de checkout do Stripe. Preciso implementar corre√ß√µes para debuggar e resolver o problema.
Problema atual:

Erro 400 na rota /api/stripe/checkout
Mensagem: "Itens inv√°lidos para checkout"
N√£o consigo identificar exatamente onde est√° o problema

O que preciso implementar:
1. Middleware de Debug
Adicione um middleware ANTES da rota /api/stripe/checkout para capturar e logar todos os dados da requisi√ß√£o:
javascriptapp.use('/api/stripe/checkout', (req, res, next) => {
  console.log('üîç === DEBUG STRIPE CHECKOUT ===');
  console.log('üì• Headers:', JSON.stringify(req.headers, null, 2));
  console.log('üì¶ Body raw:', req.body);
  console.log('üìã Body type:', typeof req.body);
  console.log('üìä Body keys:', Object.keys(req.body || {}));
  console.log('üî¢ Content-Length:', req.headers['content-length']);
  console.log('üìù Content-Type:', req.headers['content-type']);
  console.log('================================');
  next();
});
2. Rota de Checkout Melhorada
Substitua a rota atual /api/stripe/checkout por uma vers√£o com valida√ß√£o robusta e logs detalhados que:

Valide se o body da requisi√ß√£o existe
Verifique se items √© um array v√°lido
Valide cada item individualmente (nome, pre√ßo, quantidade)
Adicione logs em cada etapa do processo
Retorne erros espec√≠ficos e detalhados
Verifique se a chave do Stripe est√° configurada
Crie os line_items corretamente para o Stripe
Implemente tratamento de erro completo

3. Configura√ß√£o de Middlewares
Certifique-se de que estes middlewares est√£o configurados ANTES das rotas:
javascriptapp.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true, limit: '10mb' }));
4. Estrutura de Dados Esperada
A rota deve aceitar dados no formato:
json{
  "items": [
    {
      "name": "Nome do Produto",
      "description": "Descri√ß√£o opcional",
      "price": 29.99,
      "quantity": 1
    }
  ],
  "successUrl": "url_opcional",
  "cancelUrl": "url_opcional"
}
5. Requisitos de Valida√ß√£o

Nome: string obrigat√≥ria, n√£o vazia
Pre√ßo: n√∫mero maior que zero
Quantidade: n√∫mero inteiro maior que zero
Items: array n√£o vazio

6. Resposta de Sucesso
json{
  "success": true,
  "sessionId": "cs_session_id",
  "url": "https://checkout.stripe.com/..."
}
7. Resposta de Erro
json{
  "error": "Descri√ß√£o do erro",
  "details": "Detalhes espec√≠ficos",
  "received": "dados que foram recebidos",
  "timestamp": "2025-05-22T..."
}
Configura√ß√£o Stripe
Certifique-se de usar:

Moeda: 'brl'
M√©todo de pagamento: ['card']
Modo: 'payment'
unit_amount: pre√ßo * 100 (centavos)

Objetivos:

Identificar exatamente onde est√° o erro 400
Implementar valida√ß√£o robusta dos dados
Adicionar logs detalhados para debug
Melhorar tratamento de erros
Manter compatibilidade com c√≥digo existente

Por favor, implemente essas corre√ß√µes mantendo a estrutura atual do projeto e sem quebrar funcionalidades existentes.
Arquivos para modificar:

server/routes.ts ou server/index.ts (onde est√° a rota atual)
Adicionar logs apenas, sem alterar l√≥gica de neg√≥cio existente

Implemente as corre√ß√µes e me informe quando estiver pronto para testar!